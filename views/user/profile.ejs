
<% layout('boilerplate') -%>

<div class="row mt-3">
    <div class="col-lg-12 d-none d-lg-block">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="/users">Пользователи</a></li>
                <li class="breadcrumb-item active" aria-current="page"><%= profile.name %></li>
            </ol>
        </nav>
    </div>
</div>


<div class="row">

<div class="col-md-8 margintop20">
    <div class="row">

        <div class="col-sm-3">

            <img src="/images/user.png" alt="Profile photo" class="img-thumbnail rounded">

        </div>

        <div class="col-sm-9">
            <h1 class="mt-0"><%= profile.name %></h1>
        </div>
    </div>

    <% if (user && user.user && (user.user.id === 1 || user.user.id == profile.id)) { %>



        <div class="row mt-3">
            <div class="col-sm-12">
                <div class="alert alert-danger" role="alert">
                    <h4 class="alert-heading">Закрытый раздел</h4>

                    <div class="errors alert alert-danger hidden"></div>

                    <p>Видно только работникам сайта для выплаты призовых</p>
                    <hr>
                    <div class="form-group">
                        <form action="" method="post" id="secret_form">
                            <label for="exampleFormControlTextarea1">Укажите удобные для вас способы выплаты призовых</label>
                            <textarea class="form-control" id="secret" rows="4"><%= (typeof profile !== "undefined") ? profile.secret : "" %></textarea>

                            <div class="mt-2 text-right">
                                <button class="btn btn-danger" type="submit">Save</button>
                            </div>

                        </form>
                    </div>
                </div>
            </div>
        </div>

    <% } %>

    <script>
        $("#secret_form").on("submit", function () {
            $(".errors").addClass("hidden").empty();

            $.post("/users/update"  , {
                secret : $("#secret").val(),
            }).done(function (data) {
                if (data.status != "ok") {
                    $(".errors").removeClass("hidden");
                    for (var obj in data.errors) {
                        $(".errors").append(data.errors[obj].msg);
                    }
                } else {

                }
            }).fail(function (data, jqXHR, textStatus) {
                $(".errors").removeClass("hidden");
                if (data) {
                    for (var obj in data.responseJSON.errors) {
                        $(".errors").append(data.responseJSON.errors[obj].msg + "<br/>");

                    }
                } else {
                    alert("Ошибка сохранения");
                }
            });
            return false;
        });
    </script>


    </div>


</div>