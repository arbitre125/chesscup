var Chess=function(r){function e(r){"undefined"==typeof r&&(r=!1),ar=new Array(128),lr={w:x,b:x},pr=U,sr={w:0,b:0},cr=x,vr=0,gr=1,hr=[],r||(dr={}),u(i())}function n(){t(H)}function t(r,n){"undefined"==typeof n&&(n=!1);var t=r.split(/\s+/),f=t[0],a=0;if(!o(r).valid)return!1;e(n);for(var p=0;p<f.length;p++){var s=f.charAt(p);if("/"===s)a+=8;else if(O(s))a+=parseInt(s,10);else{var c="a">s?U:Q;l({type:s.toLowerCase(),color:c},R(a)),a++}}return pr=t[1],t[2].indexOf("K")>-1&&(sr.w|=er.KSIDE_CASTLE),t[2].indexOf("Q")>-1&&(sr.w|=er.QSIDE_CASTLE),t[2].indexOf("k")>-1&&(sr.b|=er.KSIDE_CASTLE),t[2].indexOf("q")>-1&&(sr.b|=er.QSIDE_CASTLE),cr="-"===t[3]?x:fr[t[3]],vr=parseInt(t[4],10),gr=parseInt(t[5],10),u(i()),!0}function o(r){var e={0:"No errors.",1:"FEN string must contain six space-delimited fields.",2:"6th field (move number) must be a positive integer.",3:"5th field (half move counter) must be a non-negative integer.",4:"4th field (en-passant square) is invalid.",5:"3rd field (castling availability) is invalid.",6:"2nd field (side to move) is invalid.",7:"1st field (piece positions) does not contain 8 '/'-delimited rows.",8:"1st field (piece positions) is invalid [consecutive numbers].",9:"1st field (piece positions) is invalid [invalid piece].",10:"1st field (piece positions) is invalid [row too large].",11:"Illegal en-passant square"},n=r.split(/\s+/);if(6!==n.length)return{valid:!1,error_number:1,error:e[1]};if(isNaN(n[5])||parseInt(n[5],10)<=0)return{valid:!1,error_number:2,error:e[2]};if(isNaN(n[4])||parseInt(n[4],10)<0)return{valid:!1,error_number:3,error:e[3]};if(!/^(-|[abcdefgh][36])$/.test(n[3]))return{valid:!1,error_number:4,error:e[4]};if(!/^(KQ?k?q?|Qk?q?|kq?|q|-)$/.test(n[2]))return{valid:!1,error_number:5,error:e[5]};if(!/^(w|b)$/.test(n[1]))return{valid:!1,error_number:6,error:e[6]};var t=n[0].split("/");if(8!==t.length)return{valid:!1,error_number:7,error:e[7]};for(var o=0;o<t.length;o++){for(var i=0,f=!1,u=0;u<t[o].length;u++)if(isNaN(t[o][u])){if(!/^[prnbqkPRNBQK]$/.test(t[o][u]))return{valid:!1,error_number:9,error:e[9]};i+=1,f=!1}else{if(f)return{valid:!1,error_number:8,error:e[8]};i+=parseInt(t[o][u],10),f=!0}if(8!==i)return{valid:!1,error_number:10,error:e[10]}}return"3"==n[3][1]&&"w"==n[1]||"6"==n[3][1]&&"b"==n[1]?{valid:!1,error_number:11,error:e[11]}:{valid:!0,error_number:0,error:e[0]}}function i(){for(var r=0,e="",n=fr.a8;n<=fr.h1;n++){if(null==ar[n])r++;else{r>0&&(e+=r,r=0);var t=ar[n].color,o=ar[n].type;e+=t===U?o.toUpperCase():o.toLowerCase()}n+1&136&&(r>0&&(e+=r),n!==fr.h1&&(e+="/"),r=0,n+=8)}var i="";sr[U]&er.KSIDE_CASTLE&&(i+="K"),sr[U]&er.QSIDE_CASTLE&&(i+="Q"),sr[Q]&er.KSIDE_CASTLE&&(i+="k"),sr[Q]&er.QSIDE_CASTLE&&(i+="q"),i=i||"-";var f=cr===x?"-":R(cr);return[e,pr,i,f,vr,gr].join(" ")}function f(r){for(var e=0;e<r.length;e+=2)"string"==typeof r[e]&&"string"==typeof r[e+1]&&(dr[r[e]]=r[e+1]);return dr}function u(r){hr.length>0||(r!==H?(dr.SetUp="1",dr.FEN=r):(delete dr.SetUp,delete dr.FEN))}function a(r){var e=ar[fr[r]];return e?{type:e.type,color:e.color}:null}function l(r,e){if(!("type"in r&&"color"in r))return!1;if(-1===W.indexOf(r.type.toLowerCase()))return!1;if(!(e in fr))return!1;var n=fr[e];return r.type==F&&lr[r.color]!=x&&lr[r.color]!=n?!1:(ar[n]={type:r.type,color:r.color},r.type===F&&(lr[r.color]=n),u(i()),!0)}function p(r){var e=a(r);return ar[fr[r]]=null,e&&e.type===F&&(lr[e.color]=x),u(i()),e}function s(r,e,n,t,o){var i={color:pr,from:e,to:n,flags:t,piece:r[e].type};return o&&(i.flags|=er.PROMOTION,i.promotion=o),r[n]?i.captured=r[n].type:t&er.EP_CAPTURE&&(i.captured=j),i}function c(r){function e(r,e,n,t,o){if(r[n].type!==j||w(t)!==ir&&w(t)!==nr)e.push(s(r,n,t,o));else for(var i=[G,M,$,B],f=0,u=i.length;u>f;f++)e.push(s(r,n,t,o,i[f]))}var n=[],t=pr,o=N(t),i={b:or,w:tr},f=fr.a8,u=fr.h1,a=!1,l="undefined"!=typeof r&&"legal"in r?r.legal:!0;if("undefined"!=typeof r&&"square"in r){if(!(r.square in fr))return[];f=u=fr[r.square],a=!0}for(var p=f;u>=p;p++)if(136&p)p+=7;else{var c=ar[p];if(null!=c&&c.color===t)if(c.type===j){var v=p+z[t][0];if(null==ar[v]){e(ar,n,p,v,er.NORMAL);var v=p+z[t][1];i[t]===w(p)&&null==ar[v]&&e(ar,n,p,v,er.BIG_PAWN)}for(g=2;4>g;g++){var v=p+z[t][g];136&v||(null!=ar[v]&&ar[v].color===o?e(ar,n,p,v,er.CAPTURE):v===cr&&e(ar,n,p,cr,er.EP_CAPTURE))}}else for(var g=0,E=J[c.type].length;E>g;g++)for(var b=J[c.type][g],v=p;;){if(v+=b,136&v)break;if(null!=ar[v]){if(ar[v].color===t)break;e(ar,n,p,v,er.CAPTURE);break}if(e(ar,n,p,v,er.NORMAL),"n"===c.type||"k"===c.type)break}}if(!a||u===lr[t]){if(sr[t]&er.KSIDE_CASTLE){var _=lr[t],y=_+2;null!=ar[_+1]||null!=ar[y]||h(o,lr[t])||h(o,_+1)||h(o,y)||e(ar,n,lr[t],y,er.KSIDE_CASTLE)}if(sr[t]&er.QSIDE_CASTLE){var _=lr[t],y=_-2;null!=ar[_-1]||null!=ar[_-2]||null!=ar[_-3]||h(o,lr[t])||h(o,_-1)||h(o,y)||e(ar,n,lr[t],y,er.QSIDE_CASTLE)}}if(!l)return n;for(var m=[],p=0,E=n.length;E>p;p++)S(n[p]),d(t)||m.push(n[p]),C();return m}function v(r,e){var n="";if(r.flags&er.KSIDE_CASTLE)n="O-O";else if(r.flags&er.QSIDE_CASTLE)n="O-O-O";else{var t=T(r,e);r.piece!==j&&(n+=r.piece.toUpperCase()+t),r.flags&(er.CAPTURE|er.EP_CAPTURE)&&(r.piece===j&&(n+=R(r.from)[0]),n+="x"),n+=R(r.to),r.flags&er.PROMOTION&&(n+="="+r.promotion.toUpperCase())}return S(r),E()&&(n+=b()?"#":"+"),C(),n}function g(r){return r.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}function h(r,e){for(var n=fr.a8;n<=fr.h1;n++)if(136&n)n+=7;else if(null!=ar[n]&&ar[n].color===r){var t=ar[n],o=n-e,i=o+119;if(V[i]&1<<Y[t.type]){if(t.type===j){if(o>0){if(t.color===U)return!0}else if(t.color===Q)return!0;continue}if("n"===t.type||"k"===t.type)return!0;for(var f=X[i],u=n+f,a=!1;u!==e;){if(null!=ar[u]){a=!0;break}u+=f}if(!a)return!0}}return!1}function d(r){return h(N(r),lr[r])}function E(){return d(pr)}function b(){return E()&&0===c().length}function _(){return!E()&&0===c().length}function y(){for(var r={},e=[],n=0,t=0,o=fr.a8;o<=fr.h1;o++)if(t=(t+1)%2,136&o)o+=7;else{var i=ar[o];i&&(r[i.type]=i.type in r?r[i.type]+1:1,i.type===$&&e.push(t),n++)}if(2===n)return!0;if(3===n&&(1===r[$]||1===r[B]))return!0;if(n===r[$]+2){for(var f=0,u=e.length,o=0;u>o;o++)f+=e[o];if(0===f||f===u)return!0}return!1}function m(){for(var r=[],e={},n=!1;;){var t=C();if(!t)break;r.push(t)}for(;;){var o=i().split(" ").slice(0,4).join(" ");if(e[o]=o in e?e[o]+1:1,e[o]>=3&&(n=!0),!r.length)break;S(r.pop())}return n}function A(r){hr.push({move:r,kings:{b:lr.b,w:lr.w},turn:pr,castling:{b:sr.b,w:sr.w},ep_square:cr,half_moves:vr,move_number:gr})}function S(r){var e=pr,n=N(e);if(A(r),ar[r.to]=ar[r.from],ar[r.from]=null,r.flags&er.EP_CAPTURE&&(pr===Q?ar[r.to-16]=null:ar[r.to+16]=null),r.flags&er.PROMOTION&&(ar[r.to]={type:r.promotion,color:e}),ar[r.to].type===F){if(lr[ar[r.to].color]=r.to,r.flags&er.KSIDE_CASTLE){var t=r.to-1,o=r.to+1;ar[t]=ar[o],ar[o]=null}else if(r.flags&er.QSIDE_CASTLE){var t=r.to+1,o=r.to-2;ar[t]=ar[o],ar[o]=null}sr[e]=""}if(sr[e])for(var i=0,f=ur[e].length;f>i;i++)if(r.from===ur[e][i].square&&sr[e]&ur[e][i].flag){sr[e]^=ur[e][i].flag;break}if(sr[n])for(var i=0,f=ur[n].length;f>i;i++)if(r.to===ur[n][i].square&&sr[n]&ur[n][i].flag){sr[n]^=ur[n][i].flag;break}cr=r.flags&er.BIG_PAWN?"b"===pr?r.to-16:r.to+16:x,r.piece===j?vr=0:r.flags&(er.CAPTURE|er.EP_CAPTURE)?vr=0:vr++,pr===Q&&gr++,pr=N(pr)}function C(){var r=hr.pop();if(null==r)return null;var e=r.move;lr=r.kings,pr=r.turn,sr=r.castling,cr=r.ep_square,vr=r.half_moves,gr=r.move_number;var n=pr,t=N(pr);if(ar[e.from]=ar[e.to],ar[e.from].type=e.piece,ar[e.to]=null,e.flags&er.CAPTURE)ar[e.to]={type:e.captured,color:t};else if(e.flags&er.EP_CAPTURE){var o;o=n===Q?e.to-16:e.to+16,ar[o]={type:j,color:t}}if(e.flags&(er.KSIDE_CASTLE|er.QSIDE_CASTLE)){var i,f;e.flags&er.KSIDE_CASTLE?(i=e.to+1,f=e.to-1):e.flags&er.QSIDE_CASTLE&&(i=e.to-2,f=e.to+1),ar[i]=ar[f],ar[f]=null}return e}function T(r,e){for(var n=c({legal:!e}),t=r.from,o=r.to,i=r.piece,f=0,u=0,a=0,l=0,p=n.length;p>l;l++){var s=n[l].from,v=n[l].to,g=n[l].piece;i===g&&t!==s&&o===v&&(f++,w(t)===w(s)&&u++,L(t)===L(s)&&a++)}return f>0?u>0&&a>0?R(t):R(t).charAt(a>0?1:0):""}function I(){for(var r="   +------------------------+\n",e=fr.a8;e<=fr.h1;e++){if(0===L(e)&&(r+=" "+"87654321"[w(e)]+" |"),null==ar[e])r+=" . ";else{var n=ar[e].type,t=ar[e].color,o=t===U?n.toUpperCase():n.toLowerCase();r+=" "+o+" "}e+1&136&&(r+="|\n",e+=8)}return r+="   +------------------------+\n",r+="     a  b  c  d  e  f  g  h\n"}function P(r,e){var n=g(r);if(e){var t=n.match(/([pnbrqkPNBRQK])?([a-h][1-8])x?-?([a-h][1-8])([qrbnQRBN])?/);if(t)var o=t[1],i=t[2],f=t[3],u=t[4]}for(var a=c(),l=0,p=a.length;p>l;l++){if(n===g(v(a[l]))||e&&n===g(v(a[l],!0)))return a[l];if(!(!t||o&&o.toLowerCase()!=a[l].piece||fr[i]!=a[l].from||fr[f]!=a[l].to||u&&u.toLowerCase()!=a[l].promotion))return a[l]}return null}function w(r){return r>>4}function L(r){return 15&r}function R(r){var e=L(r),n=w(r);return"abcdefgh".substring(e,e+1)+"87654321".substring(n,n+1)}function N(r){return r===U?Q:U}function O(r){return-1!=="0123456789".indexOf(r)}function k(r){var e=q(r);e.san=v(e,!1),e.to=R(e.to),e.from=R(e.from);var n="";for(var t in er)er[t]&e.flags&&(n+=rr[t]);return e.flags=n,e}function q(r){var e=r instanceof Array?[]:{};for(var n in r)"object"==typeof n?e[n]=q(r[n]):e[n]=r[n];return e}function D(r){return r.replace(/^\s+|\s+$/g,"")}function K(r){for(var e=c({legal:!1}),n=0,t=pr,o=0,i=e.length;i>o;o++){if(S(e[o]),!d(t))if(r-1>0){var f=K(r-1);n+=f}else n++;C()}return n}var Q="b",U="w",x=-1,j="p",B="n",$="b",M="r",G="q",F="k",W="pnbrqkPNBRQK",H="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",Z=["1-0","0-1","1/2-1/2","*"],z={b:[16,32,17,15],w:[-16,-32,-17,-15]},J={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},V=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],X=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],Y={p:0,n:1,b:2,r:3,q:4,k:5},rr={NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q"},er={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64},nr=7,tr=6,or=1,ir=0,fr={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},ur={w:[{square:fr.a1,flag:er.QSIDE_CASTLE},{square:fr.h1,flag:er.KSIDE_CASTLE}],b:[{square:fr.a8,flag:er.QSIDE_CASTLE},{square:fr.h8,flag:er.KSIDE_CASTLE}]},ar=new Array(128),lr={w:x,b:x},pr=U,sr={w:0,b:0},cr=x,vr=0,gr=1,hr=[],dr={};return t("undefined"==typeof r?H:r),{WHITE:U,BLACK:Q,PAWN:j,KNIGHT:B,BISHOP:$,ROOK:M,QUEEN:G,KING:F,SQUARES:function(){for(var r=[],e=fr.a8;e<=fr.h1;e++)136&e?e+=7:r.push(R(e));return r}(),FLAGS:rr,load:function(r){return t(r)},reset:function(){return n()},moves:function(r){for(var e=c(r),n=[],t=0,o=e.length;o>t;t++)n.push("undefined"!=typeof r&&"verbose"in r&&r.verbose?k(e[t]):v(e[t],!1));return n},in_check:function(){return E()},in_checkmate:function(){return b()},in_stalemate:function(){return _()},in_draw:function(){return vr>=100||_()||y()||m()},insufficient_material:function(){return y()},in_threefold_repetition:function(){return m()},game_over:function(){return vr>=100||b()||_()||y()||m()},validate_fen:function(r){return o(r)},fen:function(){return i()},board:function(){for(var r=[],e=[],n=fr.a8;n<=fr.h1;n++)e.push(null==ar[n]?null:{type:ar[n].type,color:ar[n].color}),n+1&136&&(r.push(e),e=[],n+=8);return r},pgn:function(r){var e="object"==typeof r&&"string"==typeof r.newline_char?r.newline_char:"\n",n="object"==typeof r&&"number"==typeof r.max_width?r.max_width:0,t=[],o=!1;for(var i in dr)t.push("["+i+' "'+dr[i]+'"]'+e),o=!0;o&&hr.length&&t.push(e);for(var f=[];hr.length>0;)f.push(C());for(var u=[],a="";f.length>0;){var l=f.pop();hr.length||"b"!==l.color?"w"===l.color&&(a.length&&u.push(a),a=gr+"."):a=gr+". ...",a=a+" "+v(l,!1),S(l)}if(a.length&&u.push(a),"undefined"!=typeof dr.Result&&u.push(dr.Result),0===n)return t.join("")+u.join(" ");for(var p=0,i=0;i<u.length;i++)p+u[i].length>n&&0!==i?(" "===t[t.length-1]&&t.pop(),t.push(e),p=0):0!==i&&(t.push(" "),p++),t.push(u[i]),p+=u[i].length;return t.join("")},load_pgn:function(r,e){function o(r){return r.replace(/\\/g,"\\")}function i(r){for(var e in r)return!0;return!1}function u(r,e){for(var n="object"==typeof e&&"string"==typeof e.newline_char?e.newline_char:"\r?\n",t={},i=r.split(new RegExp(o(n))),f="",u="",a=0;a<i.length;a++)f=i[a].replace(/^\[([A-Z][A-Za-z]*)\s.*\]$/,"$1"),u=i[a].replace(/^\[[A-Za-z]+\s"(.*)"\]$/,"$1"),D(f).length>0&&(t[f]=u);return t}var a="undefined"!=typeof e&&"sloppy"in e?e.sloppy:!1,l="object"==typeof e&&"string"==typeof e.newline_char?e.newline_char:"\r?\n",p=new RegExp("^(\\[((?:"+o(l)+")|.)*\\])(?:"+o(l)+"){2}"),s=p.test(r)?p.exec(r)[1]:"";n();var c=u(s,e);for(var v in c)f([v,c[v]]);if("1"===c.SetUp&&!("FEN"in c&&t(c.FEN,!0)))return!1;var g=r.replace(s,"").replace(new RegExp(o(l),"g")," ");g=g.replace(/(\{[^}]+\})+?/g,"");for(var h=/(\([^\(\)]+\))+?/g;h.test(g);)g=g.replace(h,"");g=g.replace(/\d+\.(\.\.)?/g,""),g=g.replace(/\.\.\./g,""),g=g.replace(/\$\d+/g,"");var d=D(g).split(new RegExp(/\s+/));d=d.join(",").replace(/,,+/g,",").split(",");for(var E="",b=0;b<d.length-1;b++){if(E=P(d[b],a),null==E)return!1;S(E)}if(E=d[d.length-1],Z.indexOf(E)>-1)i(dr)&&"undefined"==typeof dr.Result&&f(["Result",E]);else{if(E=P(E,a),null==E)return!1;S(E)}return!0},header:function(){return f(arguments)},ascii:function(){return I()},turn:function(){return pr},move:function(r,e){var n="undefined"!=typeof e&&"sloppy"in e?e.sloppy:!1,t=null;if("string"==typeof r)t=P(r,n);else if("object"==typeof r)for(var o=c(),i=0,f=o.length;f>i;i++)if(!(r.from!==R(o[i].from)||r.to!==R(o[i].to)||"promotion"in o[i]&&r.promotion!==o[i].promotion)){t=o[i];break}if(!t)return null;var u=k(t);return S(t),u},undo:function(){var r=C();return r?k(r):null},clear:function(){return e()},put:function(r,e){return l(r,e)},get:function(r){return a(r)},remove:function(r){return p(r)},perft:function(r){return K(r)},square_color:function(r){if(r in fr){var e=fr[r];return(w(e)+L(e))%2===0?"light":"dark"}return null},history:function(r){for(var e=[],n=[],t=("undefined"!=typeof r&&"verbose"in r&&r.verbose);hr.length>0;)e.push(C());for(;e.length>0;){var o=e.pop();n.push(t?k(o):v(o)),S(o)}return n}}};"undefined"!=typeof exports&&(exports.Chess=Chess),"undefined"!=typeof define&&define(function(){return Chess});
!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Chessground=e()}}(function(){return function e(t,r,n){function o(a,s){if(!r[a]){if(!t[a]){var c="function"==typeof require&&require;if(!s&&c)return c(a,!0);if(i)return i(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var l=r[a]={exports:{}};t[a][0].call(l.exports,function(e){var r=t[a][1][e];return o(r||e)},l,l.exports,e,t,r,n)}return r[a].exports}for(var i="function"==typeof require&&require,a=0;a<n.length;a++)o(n[a]);return o}({1:[function(e,t,r){"use strict";function n(e,t){var r=e(t);return t.dom.redraw(),r}function o(e,t){return{key:e,pos:f.key2pos(e),piece:t}}function i(e,t){return t.sort(function(t,r){return f.distanceSq(e.pos,t.pos)-f.distanceSq(e.pos,r.pos)})[0]}function a(e,t){var r,n,a,s,c={},u=[],l={},d=[],p=[],v={};for(a in e)v[a]=o(a,e[a]);for(var h=0,g=f.allKeys;h<g.length;h++){var b=g[h];r=t.pieces[b],n=v[b],r?n?f.samePiece(r,n.piece)||(d.push(n),p.push(o(b,r))):p.push(o(b,r)):n&&d.push(n)}return p.forEach(function(e){(n=i(e,d.filter(function(t){return f.samePiece(e.piece,t.piece)})))&&(s=[n.pos[0]-e.pos[0],n.pos[1]-e.pos[1]],c[e.key]=[s,s],u.push(n.key))}),d.forEach(function(e){f.containsX(u,e.key)||t.items&&t.items(e.pos,e.key)||(l[e.key]=e.piece)}),{anims:c,fadings:l}}function s(e){var t=e.animation.current;if(t){var r=1-(Date.now()-t.start)/t.duration;if(r<=0)e.animation.current=void 0,e.dom.redrawNow();else{var n=l(r);for(var o in t.plan.anims){var i=t.plan.anims[o];i[1]=[i[0][0]*n,i[0][1]*n]}e.dom.redrawNow(!0),f.raf(function(){return s(e)})}}else e.dom.destroyed||e.dom.redrawNow()}function c(e,t){var r=d({},t.pieces),n=e(t),o=a(r,t);if(u(o.anims)&&u(o.fadings))t.dom.redraw();else{var i=t.animation.current&&t.animation.current.start;t.animation.current={start:Date.now(),duration:t.animation.duration,plan:o},i||s(t)}return n}function u(e){for(var t in e)return!1;return!0}function l(e){return e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1}var d=this&&this.__assign||Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e};Object.defineProperty(r,"__esModule",{value:!0});var f=e("./util");r.anim=function(e,t){return t.animation.enabled?c(e,t):n(e,t)},r.render=n},{"./util":17}],2:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=e("./board"),o=e("./fen"),i=e("./config"),a=e("./anim"),s=e("./drag"),c=e("./explosion");r.start=function(e,t){function r(){n.toggleOrientation(e),t()}return{set:function(t){t.orientation&&t.orientation!==e.orientation&&r(),(t.fen?a.anim:a.render)(function(e){return i.configure(e,t)},e)},state:e,getFen:function(){return o.write(e.pieces)},toggleOrientation:r,setPieces:function(t){a.anim(function(e){return n.setPieces(e,t)},e)},selectSquare:function(t,r){t?a.anim(function(e){return n.selectSquare(e,t,r)},e):e.selected&&(n.unselect(e),e.dom.redraw())},move:function(t,r){a.anim(function(e){return n.baseMove(e,t,r)},e)},newPiece:function(t,r){a.anim(function(e){return n.baseNewPiece(e,t,r)},e)},playPremove:function(){if(e.premovable.current){if(a.anim(n.playPremove,e))return!0;e.dom.redraw()}return!1},playPredrop:function(t){if(e.predroppable.current){var r=n.playPredrop(e,t);return e.dom.redraw(),r}return!1},cancelPremove:function(){a.render(n.unsetPremove,e)},cancelPredrop:function(){a.render(n.unsetPredrop,e)},cancelMove:function(){a.render(function(e){n.cancelMove(e),s.cancel(e)},e)},stop:function(){a.render(function(e){n.stop(e),s.cancel(e)},e)},explode:function(t){c.default(e,t)},setAutoShapes:function(t){a.render(function(e){return e.drawable.autoShapes=t},e)},setShapes:function(t){a.render(function(e){return e.drawable.shapes=t},e)},getKeyAtDomPos:function(t){return n.getKeyAtDomPos(t,"white"===e.orientation,e.dom.bounds())},redrawAll:t,dragNewPiece:function(t,r,n){s.dragNewPiece(e,t,r,n)},destroy:function(){n.stop(e),e.dom.unbind&&e.dom.unbind(),e.dom.destroyed=!0}}}},{"./anim":1,"./board":3,"./config":5,"./drag":6,"./explosion":9,"./fen":10}],3:[function(e,t,r){"use strict";function n(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];e&&setTimeout(function(){return e.apply(void 0,t)},1)}function o(e,t,r,o){s(e),e.premovable.current=[t,r],n(e.premovable.events.set,t,r,o)}function i(e){e.premovable.current&&(e.premovable.current=void 0,n(e.premovable.events.unset))}function a(e,t,r){i(e),e.predroppable.current={role:t,key:r},n(e.predroppable.events.set,t,r)}function s(e){var t=e.predroppable;t.current&&(t.current=void 0,n(t.events.unset))}function c(e,t,r){if(!e.autoCastle)return!1;var n=e.pieces[t];if("king"!==n.role)return!1;var o=P.key2pos(t);if(5!==o[0])return!1;if(1!==o[1]&&8!==o[1])return!1;var i,a,s,c=P.key2pos(r);if(7===c[0]||8===c[0])i=P.pos2key([8,o[1]]),a=P.pos2key([6,o[1]]),s=P.pos2key([7,o[1]]);else{if(3!==c[0]&&1!==c[0])return!1;i=P.pos2key([1,o[1]]),a=P.pos2key([4,o[1]]),s=P.pos2key([3,o[1]])}var u=e.pieces[i];return"rook"===u.role&&(delete e.pieces[t],delete e.pieces[i],e.pieces[s]=n,e.pieces[a]=u,!0)}function u(e,t,r){if(t===r||!e.pieces[t])return!1;var o=e.pieces[r]&&e.pieces[r].color!==e.pieces[t].color?e.pieces[r]:void 0;return r==e.selected&&v(e),n(e.events.move,t,r,o),c(e,t,r)||(e.pieces[r]=e.pieces[t],delete e.pieces[t]),e.lastMove=[t,r],e.check=void 0,n(e.events.change),o||!0}function l(e,t,r,o){if(e.pieces[r]){if(!o)return!1;delete e.pieces[r]}return n(e.events.dropNewPiece,t,r),e.pieces[r]=t,e.lastMove=[r],e.check=void 0,n(e.events.change),e.movable.dests=void 0,e.turnColor=P.opposite(e.turnColor),!0}function d(e,t,r){var n=u(e,t,r);return n&&(e.movable.dests=void 0,e.turnColor=P.opposite(e.turnColor),e.animation.current=void 0),n}function f(e,t,r){if(g(e,t,r)){var i=d(e,t,r);if(i){var a=e.hold.stop();v(e);var s={premove:!1,ctrlKey:e.stats.ctrlKey,holdTime:a};return!0!==i&&(s.captured=i),n(e.movable.events.after,t,r,s),!0}}else y(e,t,r)?(o(e,t,r,{ctrlKey:e.stats.ctrlKey}),v(e)):h(e,r)||m(e,r)?(p(e,r),e.hold.start()):v(e);return!1}function p(e,t){e.selected=t,m(e,t)?e.premovable.dests=C.default(e.pieces,t,e.premovable.castle):e.premovable.dests=void 0}function v(e){e.selected=void 0,e.premovable.dests=void 0,e.hold.cancel()}function h(e,t){var r=e.pieces[t];return r&&("both"===e.movable.color||e.movable.color===r.color&&e.turnColor===r.color)}function g(e,t,r){return t!==r&&h(e,t)&&(e.movable.free||!!e.movable.dests&&P.containsX(e.movable.dests[t],r))}function b(e,t,r){var n=e.pieces[t];return n&&r&&(t===r||!e.pieces[r])&&("both"===e.movable.color||e.movable.color===n.color&&e.turnColor===n.color)}function m(e,t){var r=e.pieces[t];return r&&e.premovable.enabled&&e.movable.color===r.color&&e.turnColor!==r.color}function y(e,t,r){return t!==r&&m(e,t)&&P.containsX(C.default(e.pieces,t,e.premovable.castle),r)}function w(e,t,r){var n=e.pieces[t];return n&&r&&(!e.pieces[r]||e.pieces[r].color!==e.movable.color)&&e.predroppable.enabled&&("pawn"!==n.role||"1"!==r[1]&&"8"!==r[1])&&e.movable.color===n.color&&e.turnColor!==n.color}function k(e){i(e),s(e),v(e)}Object.defineProperty(r,"__esModule",{value:!0});var P=e("./util"),C=e("./premove");r.callUserFunction=n,r.toggleOrientation=function(e){e.orientation=P.opposite(e.orientation),e.animation.current=e.draggable.current=e.selected=void 0},r.reset=function(e){e.lastMove=void 0,v(e),i(e),s(e)},r.setPieces=function(e,t){for(var r in t){var n=t[r];n?e.pieces[r]=n:delete e.pieces[r]}},r.setCheck=function(e,t){if(!0===t&&(t=e.turnColor),t)for(var r in e.pieces)"king"===e.pieces[r].role&&e.pieces[r].color===t&&(e.check=r);else e.check=void 0},r.unsetPremove=i,r.unsetPredrop=s,r.baseMove=u,r.baseNewPiece=l,r.userMove=f,r.dropNewPiece=function(e,t,r,o){if(b(e,t,r)||o){var c=e.pieces[t];delete e.pieces[t],l(e,c,r,o),n(e.movable.events.afterNewPiece,c.role,r,{predrop:!1})}else w(e,t,r)?a(e,e.pieces[t].role,r):(i(e),s(e));delete e.pieces[t],v(e)},r.selectSquare=function(e,t,r){e.selected?e.selected!==t||e.draggable.enabled?(e.selectable.enabled||r)&&e.selected!==t?f(e,e.selected,t)&&(e.stats.dragged=!1):e.hold.start():(v(e),e.hold.cancel()):(h(e,t)||m(e,t))&&(p(e,t),e.hold.start()),n(e.events.select,t)},r.setSelected=p,r.unselect=v,r.canMove=g,r.isDraggable=function(e,t){var r=e.pieces[t];return r&&e.draggable.enabled&&("both"===e.movable.color||e.movable.color===r.color&&(e.turnColor===r.color||e.premovable.enabled))},r.playPremove=function(e){var t=e.premovable.current;if(!t)return!1;var r=t[0],o=t[1],a=!1;if(g(e,r,o)){var s=d(e,r,o);if(s){var c={premove:!0};!0!==s&&(c.captured=s),n(e.movable.events.after,r,o,c),a=!0}}return i(e),a},r.playPredrop=function(e,t){var r=e.predroppable.current,o=!1;return!!r&&(t(r)&&l(e,{role:r.role,color:e.movable.color},r.key)&&(n(e.movable.events.afterNewPiece,r.role,r.key,{predrop:!0}),o=!0),s(e),o)},r.cancelMove=k,r.stop=function(e){e.movable.color=e.movable.dests=e.animation.current=void 0,k(e)},r.getKeyAtDomPos=function(e,t,r){var n=Math.ceil((e[0]-r.left)/r.width*8);t||(n=9-n);var o=Math.ceil(8-(e[1]-r.top)/r.height*8);return t||(o=9-o),n>0&&n<9&&o>0&&o<9?P.pos2key([n,o]):void 0}},{"./premove":12,"./util":17}],4:[function(e,t,r){"use strict";function n(e){var t=!1;return function(){t||(t=!0,d.raf(function(){e(),t=!1}))}}Object.defineProperty(r,"__esModule",{value:!0});var o=e("./api"),i=e("./config"),a=e("./state"),s=e("./wrap"),c=e("./events"),u=e("./render"),l=e("./svg"),d=e("./util");r.Chessground=function(e,t){function r(){var t=f.dom&&f.dom.unbind;e.classList.add("cg-board-wrap");var o=d.memo(function(){return e.getBoundingClientRect()}),i=s.default(e,f,f.viewOnly&&!f.drawable.visible?void 0:o()),a=function(e){u.default(f),!e&&i.svg&&l.renderSvg(f,i.svg)};f.dom={elements:i,bounds:o,redraw:n(a),redrawNow:a,unbind:t},l.clearCache(),a(!1),c.bindBoard(f),t||(f.dom.unbind=c.bindDocument(f,r))}var f=a.defaults();return i.configure(f,t||{}),r(),o.start(f,r)}},{"./api":2,"./config":5,"./events":8,"./render":13,"./state":14,"./svg":15,"./util":17,"./wrap":18}],5:[function(e,t,r){"use strict";function n(e,t){for(var r in t)o(e[r])&&o(t[r])?n(e[r],t[r]):e[r]=t[r]}function o(e){return"object"==typeof e}Object.defineProperty(r,"__esModule",{value:!0});var i=e("./board"),a=e("./fen");r.configure=function(e,t){if(t.movable&&t.movable.dests&&(e.movable.dests=void 0),n(e,t),t.fen&&(e.pieces=a.read(t.fen),e.drawable.shapes=[]),t.hasOwnProperty("check")&&i.setCheck(e,t.check||!1),t.hasOwnProperty("lastMove")&&!t.lastMove?e.lastMove=void 0:t.lastMove&&(e.lastMove=t.lastMove),e.selected&&i.setSelected(e,e.selected),(!e.animation.duration||e.animation.duration<100)&&(e.animation.enabled=!1),!e.movable.rookCastle&&e.movable.dests){var r="white"===e.movable.color?1:8,o="e"+r,s=e.movable.dests[o];if(!s||"king"!==e.pieces[o].role)return;e.movable.dests[o]=s.filter(function(e){return!(e==="a"+r&&-1!==s.indexOf("c"+r)||e==="h"+r&&-1!==s.indexOf("g"+r))})}}},{"./board":3,"./fen":10}],6:[function(e,t,r){"use strict";function n(e){u.raf(function(){var t=e.draggable.current;if(t){e.animation.current&&e.animation.current.plan.anims[t.orig]&&(e.animation.current=void 0);var r=e.pieces[t.orig];if(r&&u.samePiece(r,t.piece)){if(!t.started&&u.distanceSq(t.epos,t.rel)>=Math.pow(e.draggable.distance,2)&&(t.started=!0),t.started){if("function"==typeof t.element){var i=t.element();if(!i)return;t.element=i,t.element.cgDragging=!0,t.element.classList.add("dragging")}var a="white"===e.orientation,s=e.dom.bounds();t.pos=[t.epos[0]-t.rel[0],t.epos[1]-t.rel[1]],t.over=c.getKeyAtDomPos(t.epos,a,s);var l=u.posToTranslateAbs(s)(t.origPos,a);l[0]+=t.pos[0]+t.dec[0],l[1]+=t.pos[1]+t.dec[1],u.translateAbs(t.element,l);var d=e.dom.elements.over;if(d&&t.over&&t.over!==t.overPrev){var f=e.movable.dests;if(e.movable.free||u.containsX(f&&f[t.orig],t.over)||u.containsX(e.premovable.dests,t.over)){var p=u.key2pos(t.over),v=[(a?p[0]-1:8-p[0])*s.width/8,(a?8-p[1]:p[1]-1)*s.height/8];u.translateAbs(d,v)}else u.translateAway(d);t.overPrev=t.over}}}else o(e);n(e)}})}function o(e){var t=e.draggable.current;t&&(t.newPiece&&delete e.pieces[t.orig],e.draggable.current=void 0,c.unselect(e),i(e),e.dom.redraw())}function i(e){var t=e.dom.elements;t.over&&u.translateAway(t.over),t.ghost&&u.translateAway(t.ghost)}function a(e,t,r){var n=u.key2pos(e);return t||(n[0]=9-n[0],n[1]=9-n[1]),{left:r.left+r.width*(n[0]-1)/8,top:r.top+r.height*(8-n[1])/8,width:r.width/8,height:r.height/8}}function s(e,t){for(var r=e.dom.elements.board.firstChild;r;){if(r.cgKey===t&&"PIECE"===r.tagName)return r;r=r.nextSibling}}Object.defineProperty(r,"__esModule",{value:!0});var c=e("./board"),u=e("./util"),l=e("./draw"),d=e("./anim");r.start=function(e,t){if(!(void 0!==t.button&&0!==t.button||t.touches&&t.touches.length>1)){t.preventDefault();var r="white"===e.orientation,o=e.dom.bounds(),i=u.eventPosition(t),f=c.getKeyAtDomPos(i,r,o);if(f){var p=e.pieces[f],v=e.selected;v||!e.drawable.enabled||!e.drawable.eraseOnClick&&p&&p.color===e.turnColor||l.clear(e);var h=!!e.premovable.current,g=!!e.predroppable.current;e.stats.ctrlKey=t.ctrlKey,e.selected&&c.canMove(e,e.selected,f)?d.anim(function(e){return c.selectSquare(e,f)},e):c.selectSquare(e,f);var b=e.selected===f,m=s(e,f);if(p&&m&&b&&c.isDraggable(e,f)){var y=a(f,r,o);e.draggable.current={orig:f,origPos:u.key2pos(f),piece:p,rel:i,epos:i,pos:[0,0],dec:e.draggable.centerPiece?[i[0]-(y.left+y.width/2),i[1]-(y.top+y.height/2)]:[0,0],started:e.draggable.autoDistance&&e.stats.dragged,element:m,previouslySelected:v,originTarget:t.target},m.cgDragging=!0,m.classList.add("dragging");var w=e.dom.elements.ghost;w&&(w.className="ghost "+p.color+" "+p.role,u.translateAbs(w,u.posToTranslateAbs(o)(u.key2pos(f),r))),n(e)}else h&&c.unsetPremove(e),g&&c.unsetPredrop(e);e.dom.redraw()}}},r.dragNewPiece=function(e,t,r,o){e.pieces.a0=t,e.dom.redraw();var i=u.eventPosition(r),c="white"===e.orientation,l=e.dom.bounds(),d=a("a0",c,l),f=[(c?0:7)*d.width+l.left,(c?8:-1)*d.height+l.top];e.draggable.current={orig:"a0",origPos:u.key2pos("a0"),piece:t,rel:f,epos:i,pos:[i[0]-f[0],i[1]-f[1]],dec:[-d.width/2,-d.height/2],started:!0,element:function(){return s(e,"a0")},originTarget:r.target,newPiece:!0,force:o||!1},n(e)},r.move=function(e,t){e.draggable.current&&(!t.touches||t.touches.length<2)&&(e.draggable.current.epos=u.eventPosition(t))},r.end=function(e,t){var r=e.draggable.current;if(r)if("touchend"!==t.type||!r||r.originTarget===t.target||r.newPiece){c.unsetPremove(e),c.unsetPredrop(e);var n=u.eventPosition(t)||r.epos,o=c.getKeyAtDomPos(n,"white"===e.orientation,e.dom.bounds());o&&r.started?r.newPiece?c.dropNewPiece(e,r.orig,o,r.force):(e.stats.ctrlKey=t.ctrlKey,c.userMove(e,r.orig,o)&&(e.stats.dragged=!0)):r.newPiece?delete e.pieces[r.orig]:e.draggable.deleteOnDropOff&&(delete e.pieces[r.orig],c.callUserFunction(e.events.change)),!r||r.orig!==r.previouslySelected||r.orig!==o&&o?e.selectable.enabled||c.unselect(e):c.unselect(e),i(e),e.draggable.current=void 0,e.dom.redraw()}else e.draggable.current=void 0},r.cancel=o},{"./anim":1,"./board":3,"./draw":7,"./util":17}],7:[function(e,t,r){"use strict";function n(e){d.raf(function(){var t=e.drawable.current;if(t){var r=l.getKeyAtDomPos(t.pos,"white"===e.orientation,e.dom.bounds()),o=t.orig===r?void 0:r;o!==t.dest&&(t.dest=o,e.dom.redrawNow()),n(e)}})}function o(e){e.drawable.current&&(e.drawable.current=void 0,e.dom.redraw())}function i(e){var t=e.shiftKey&&d.isRightButton(e)?1:0,r=e.altKey?2:0;return f[t+r]}function a(e){return function(t){return!e(t)}}function s(e,t){var r=t.orig,n=function(e){return e.orig===r&&!e.dest},o=e.shapes.filter(n)[0];o&&(e.shapes=e.shapes.filter(a(n))),o&&o.brush===t.brush||e.shapes.push({brush:t.brush,orig:r}),u(e)}function c(e,t,r){var n=t.orig,o=function(e){return!!e.dest&&e.orig===n&&e.dest===r};e.shapes.filter(o).length>0?e.shapes=e.shapes.filter(a(o)):e.shapes.push({brush:t.brush,orig:n,dest:r}),u(e)}function u(e){e.onChange&&e.onChange(e.shapes)}Object.defineProperty(r,"__esModule",{value:!0});var l=e("./board"),d=e("./util"),f=["green","red","blue","yellow"];r.start=function(e,t){if(!(t.touches&&t.touches.length>1)){t.stopPropagation(),t.preventDefault(),l.cancelMove(e);var r=d.eventPosition(t),o=l.getKeyAtDomPos(r,"white"===e.orientation,e.dom.bounds());o&&(e.drawable.current={orig:o,dest:o,pos:r,brush:i(t)},n(e))}},r.processDraw=n,r.move=function(e,t){e.drawable.current&&(e.drawable.current.pos=d.eventPosition(t))},r.end=function(e){var t=e.drawable.current;t&&(t.dest&&t.dest!==t.orig?c(e.drawable,t,t.dest):s(e.drawable,t),o(e))},r.cancel=o,r.clear=function(e){e.drawable.shapes.length&&(e.drawable.shapes=[],e.dom.redraw(),u(e.drawable))}},{"./board":3,"./util":17}],8:[function(e,t,r){"use strict";function n(e,t,r,n){return e.addEventListener(t,r,n),function(){return e.removeEventListener(t,r)}}function o(e){return function(t){e.draggable.current?a.cancel(e):e.drawable.current?s.cancel(e):t.shiftKey||c.isRightButton(t)?e.drawable.enabled&&s.start(e,t):e.viewOnly||a.start(e,t)}}function i(e,t,r){return function(n){n.shiftKey||c.isRightButton(n)?e.drawable.enabled&&r(e,n):e.viewOnly||t(e,n)}}Object.defineProperty(r,"__esModule",{value:!0});var a=e("./drag"),s=e("./draw"),c=e("./util");r.bindBoard=function(e){if(!e.viewOnly){var t=e.dom.elements.board,r=o(e);t.addEventListener("touchstart",r),t.addEventListener("mousedown",r),(e.disableContextMenu||e.drawable.enabled)&&t.addEventListener("contextmenu",function(e){return e.preventDefault()})}},r.bindDocument=function(e,t){if(e.viewOnly)return function(){};var r=i(e,a.move,s.move),o=i(e,a.end,s.end),u=[];["touchmove","mousemove"].forEach(function(e){return u.push(n(document,e,r))}),["touchend","mouseup"].forEach(function(e){return u.push(n(document,e,o))});e.resizable&&u.push(n(document.body,"chessground.resize",function(){e.dom.bounds.clear(),c.raf(t)}));var l=function(){return e.dom.bounds.clear()};return u.push(n(window,"scroll",l,{passive:!0})),u.push(n(window,"resize",l,{passive:!0})),function(){return u.forEach(function(e){return e()})}}},{"./drag":6,"./draw":7,"./util":17}],9:[function(e,t,r){"use strict";function n(e,t){e.exploding&&(t?e.exploding.stage=t:e.exploding=void 0,e.dom.redraw())}Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(e,t){e.exploding={stage:1,keys:t},e.dom.redraw(),setTimeout(function(){n(e,2),setTimeout(function(){return n(e,void 0)},120)},120)}},{}],10:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=e("./util"),o=e("./types");r.initial="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR";var i={p:"pawn",r:"rook",n:"knight",b:"bishop",q:"queen",k:"king"},a={pawn:"p",rook:"r",knight:"n",bishop:"b",queen:"q",king:"k"};r.read=function(e){"start"===e&&(e=r.initial);for(var t={},o=8,a=0,s=0,c=e;s<c.length;s++){var u=c[s];switch(u){case" ":return t;case"/":if(0==--o)return t;a=0;break;case"~":t[n.pos2key([a,o])].promoted=!0;break;default:var l=u.charCodeAt(0);if(l<57)a+=l-48;else{++a;var d=u.toLowerCase();t[n.pos2key([a,o])]={role:i[d],color:u===d?"black":"white"}}}}return t},r.write=function(e){var t,r;return n.invRanks.map(function(i){return o.ranks.map(function(o){return(t=e[n.pos2key([o,i])])?(r=a[t.role],"white"===t.color?r.toUpperCase():r):"1"}).join("")}).join("/").replace(/1{2,}/g,function(e){return e.length.toString()})}},{"./types":16,"./util":17}],11:[function(e,t,r){t.exports=e("./chessground").Chessground},{"./chessground":4}],12:[function(e,t,r){"use strict";function n(e,t){return Math.abs(e-t)}function o(e){return function(t,r,o,i){return n(t,o)<2&&("white"===e?i===r+1||r<=2&&i===r+2&&t===o:i===r-1||r>=7&&i===r-2&&t===o)}}function i(e,t,r){return function(o,i,a,c){return n(o,a)<2&&n(i,c)<2||r&&i===c&&i===("white"===e?1:8)&&(5===o&&(3===a||7===a)||s.containsX(t,a))}}function a(e,t){var r;return Object.keys(e).filter(function(n){return(r=e[n])&&r.color===t&&"rook"===r.role}).map(function(e){return s.key2pos(e)[0]})}Object.defineProperty(r,"__esModule",{value:!0});var s=e("./util"),c=function(e,t,r,o){var i=n(e,r),a=n(t,o);return 1===i&&2===a||2===i&&1===a},u=function(e,t,r,o){return n(e,r)===n(t,o)},l=function(e,t,r,n){return e===r||t===n},d=function(e,t,r,n){return u(e,t,r,n)||l(e,t,r,n)};r.default=function(e,t,r){var n,f=e[t],p=s.key2pos(t);switch(f.role){case"pawn":n=o(f.color);break;case"knight":n=c;break;case"bishop":n=u;break;case"rook":n=l;break;case"queen":n=d;break;case"king":n=i(f.color,a(e,f.color),r)}return s.allKeys.map(s.key2pos).filter(function(e){return(p[0]!==e[0]||p[1]!==e[1])&&n(p[0],p[1],e[0],e[1])}).map(s.pos2key)}},{"./util":17}],13:[function(e,t,r){"use strict";function n(e){return"PIECE"===e.tagName}function o(e){return"SQUARE"===e.tagName}function i(e,t){for(var r in t)e.dom.elements.board.removeChild(t[r])}function a(e,t){var r=2+8*(e[1]-1)+(8-e[0]);return t&&(r=67-r),r+""}function s(e){return e.color+" "+e.role}function c(e){var t,r,n={};if(e.lastMove&&e.highlight.lastMove)for(t in e.lastMove)u(n,e.lastMove[t],"last-move");if(e.check&&e.highlight.check&&u(n,e.check,"check"),e.selected&&(u(n,e.selected,"selected"),e.movable.showDests)){var o=e.movable.dests&&e.movable.dests[e.selected];if(o)for(t in o)u(n,r=o[t],"move-dest"+(e.pieces[r]?" oc":""));var i=e.premovable.dests;if(i)for(t in i)u(n,r=i[t],"premove-dest"+(e.pieces[r]?" oc":""))}var a=e.premovable.current;if(a)for(t in a)u(n,a[t],"current-premove");else e.predroppable.current&&u(n,e.predroppable.current.key,"current-premove");var s=e.exploding;if(s)for(t in s.keys)u(n,s.keys[t],"exploding"+s.stage);return n}function u(e,t,r){e[t]?e[t]+=" "+r:e[t]=r}Object.defineProperty(r,"__esModule",{value:!0});var l=e("./util"),d=e("./util");r.default=function(e){var t,r,u,f,p,v,h,g,b,m,y,w="white"===e.orientation,k=e.viewOnly?d.posToTranslateRel:d.posToTranslateAbs(e.dom.bounds()),P=e.viewOnly?d.translateRel:d.translateAbs,C=e.dom.elements.board,M=e.pieces,O=e.animation.current,x=O?O.plan.anims:{},A=O?O.plan.fadings:{},_=e.draggable.current,E=c(e),D={},K={},j={},S={},T=Object.keys(M);for(u=C.firstChild;u;){if(t=u.cgKey,n(u))f=M[t],v=x[t],h=A[t],p=u.cgPiece,!u.cgDragging||_&&_.orig===t||(u.classList.remove("dragging"),P(u,k(l.key2pos(t),w)),u.cgDragging=!1),!h&&u.cgFading&&(u.cgFading=!1,u.classList.remove("fading")),f?(v&&u.cgAnimating&&p===s(f)?((F=l.key2pos(t))[0]+=v[1][0],F[1]+=v[1][1],u.classList.add("anim"),P(u,k(F,w))):u.cgAnimating&&(u.cgAnimating=!1,u.classList.remove("anim"),P(u,k(l.key2pos(t),w)),e.addPieceZIndex&&(u.style.zIndex=a(l.key2pos(t),w))),p!==s(f)||h&&u.cgFading?h&&p===s(h)?(u.classList.add("fading"),u.cgFading=!0):j[p]?j[p].push(u):j[p]=[u]:D[t]=!0):j[p]?j[p].push(u):j[p]=[u];else if(o(u)){var N=u.className;E[t]===N?K[t]=!0:S[N]?S[N].push(u):S[N]=[u]}u=u.nextSibling}for(var L in E)if(!K[L]){y=(m=S[E[L]])&&m.pop();var q=k(l.key2pos(L),w);if(y)y.cgKey=L,P(y,q);else{var R=l.createEl("square",E[L]);R.cgKey=L,P(R,q),C.insertBefore(R,C.firstChild)}}for(var W in T)if(t=T[W],r=M[t],v=x[t],!D[t])if(g=j[s(r)],b=g&&g.pop())b.cgKey=t,b.cgFading&&(b.classList.remove("fading"),b.cgFading=!1),F=l.key2pos(t),e.addPieceZIndex&&(b.style.zIndex=a(F,w)),v&&(b.cgAnimating=!0,b.classList.add("anim"),F[0]+=v[1][0],F[1]+=v[1][1]),P(b,k(F,w));else{var B=s(r),X=l.createEl("piece",B),F=l.key2pos(t);X.cgPiece=B,X.cgKey=t,v&&(X.cgAnimating=!0,F[0]+=v[1][0],F[1]+=v[1][1]),P(X,k(F,w)),e.addPieceZIndex&&(X.style.zIndex=a(F,w)),C.appendChild(X)}for(var I in j)i(e,j[I]);for(var I in S)i(e,S[I])}},{"./util":17}],14:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=e("./fen"),o=e("./util");r.defaults=function(){return{pieces:n.read(n.initial),orientation:"white",turnColor:"white",coordinates:!0,autoCastle:!0,viewOnly:!1,disableContextMenu:!1,resizable:!0,addPieceZIndex:!1,pieceKey:!1,highlight:{lastMove:!0,check:!0},animation:{enabled:!0,duration:200},movable:{free:!0,color:"both",showDests:!0,events:{},rookCastle:!0},premovable:{enabled:!0,showDests:!0,castle:!0,events:{}},predroppable:{enabled:!1,events:{}},draggable:{enabled:!0,distance:3,autoDistance:!0,centerPiece:!0,showGhost:!0,deleteOnDropOff:!1},selectable:{enabled:!0},stats:{dragged:!("ontouchstart"in window)},events:{},drawable:{enabled:!0,visible:!0,eraseOnClick:!0,shapes:[],autoShapes:[],brushes:{green:{key:"g",color:"#15781B",opacity:1,lineWidth:10},red:{key:"r",color:"#882020",opacity:1,lineWidth:10},blue:{key:"b",color:"#003088",opacity:1,lineWidth:10},yellow:{key:"y",color:"#e68f00",opacity:1,lineWidth:10},paleBlue:{key:"pb",color:"#003088",opacity:.4,lineWidth:15},paleGreen:{key:"pg",color:"#15781B",opacity:.4,lineWidth:15},paleRed:{key:"pr",color:"#882020",opacity:.4,lineWidth:15},paleGrey:{key:"pgr",color:"#4a4a4a",opacity:.35,lineWidth:15}},pieces:{baseUrl:"https://lichess1.org/assets/piece/cburnett/"}},hold:o.timer()}}},{"./fen":10,"./util":17}],15:[function(e,t,r){"use strict";function n(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function o(e,t,r){var n,o={};t.forEach(function(t){t.shape.dest&&(n=e.brushes[t.shape.brush],t.shape.modifiers&&(n=g(n,t.shape.modifiers)),o[n.key]=n)});for(var i={},a=r.firstChild;a;)i[a.getAttribute("cgKey")]=!0,a=a.nextSibling;for(var s in o)i[s]||r.appendChild(p(o[s]))}function i(e,t,r,n,o,i){void 0===C&&(C=P.computeIsTrident());var a=e.dom.bounds(),s={},c=[];t.forEach(function(e){s[e.hash]=!1});for(var l,d=i.nextSibling;d;)l=d.getAttribute("cgHash"),s.hasOwnProperty(l)?s[l]=!0:c.push(d),d=d.nextSibling;c.forEach(function(e){return o.removeChild(e)}),t.forEach(function(t){s[t.hash]||o.appendChild(u(e,t,r,n,a))})}function a(e,t,r){var n=e.orig,o=e.dest,i=e.brush,a=e.piece,u=e.modifiers;return[r,n,o,i,o&&t[o],a&&s(a),u&&c(u)].filter(function(e){return e}).join("")}function s(e){return[e.color,e.role,e.scale].filter(function(e){return e}).join("")}function c(e){return""+(e.lineWidth||"")}function u(e,t,r,n,o){var i,a=t.shape,s=t.current,c=t.hash;if(a.piece)i=f(e.drawable.pieces.baseUrl,h(P.key2pos(a.orig),e.orientation),a.piece,o);else{var u=h(P.key2pos(a.orig),e.orientation);if(a.orig&&a.dest){var p=r[a.brush];a.modifiers&&(p=g(p,a.modifiers)),i=d(p,u,h(P.key2pos(a.dest),e.orientation),s,n[a.dest]>1,o)}else i=l(r[a.brush],u,s,o)}return i.setAttribute("cgHash",c),i}function l(e,t,r,o){var i=k(t,o),a=b(r,o),s=(o.width+o.height)/32;return v(n("circle"),{stroke:e.color,"stroke-width":a,fill:"none",opacity:y(e,r),cx:i[0],cy:i[1],r:s-a/2})}function d(e,t,r,o,i,a){var s=w(a,i&&!o),c=k(t,a),u=k(r,a),l=u[0]-c[0],d=u[1]-c[1],f=Math.atan2(d,l),p=Math.cos(f)*s,h=Math.sin(f)*s;return v(n("line"),{stroke:e.color,"stroke-width":m(e,o,a),"stroke-linecap":"round","marker-end":C?void 0:"url(#arrowhead-"+e.key+")",opacity:y(e,o),x1:c[0],y1:c[1],x2:u[0]-p,y2:u[1]-h})}function f(e,t,r,o){var i=k(t,o),a=o.width/8*(r.scale||1),s=r.color[0]+("knight"===r.role?"n":r.role[0]).toUpperCase();return v(n("image"),{className:r.role+" "+r.color,x:i[0]-a/2,y:i[1]-a/2,width:a,height:a,href:e+s+".svg"})}function p(e){var t=v(n("marker"),{id:"arrowhead-"+e.key,orient:"auto",markerWidth:4,markerHeight:8,refX:2.05,refY:2.01});return t.appendChild(v(n("path"),{d:"M0,0 V4 L3,2 Z",fill:e.color})),t.setAttribute("cgKey",e.key),t}function v(e,t){for(var r in t)e.setAttribute(r,t[r]);return e}function h(e,t){return"white"===t?e:[9-e[0],9-e[1]]}function g(e,t){var r={color:e.color,opacity:Math.round(10*e.opacity)/10,lineWidth:Math.round(t.lineWidth||e.lineWidth)};return r.key=[e.key,t.lineWidth].filter(function(e){return e}).join(""),r}function b(e,t){return(e?3:4)/512*t.width}function m(e,t,r){return(e.lineWidth||10)*(t?.85:1)/512*r.width}function y(e,t){return(e.opacity||1)*(t?.9:1)}function w(e,t){return C?0:(t?20:10)/512*e.width}function k(e,t){return[(e[0]-.5)*t.width/8,(8.5-e[1])*t.height/8]}Object.defineProperty(r,"__esModule",{value:!0});var P=e("./util");r.createElement=n;var C,M="";r.clearCache=function(){M=""},r.renderSvg=function(e,t){var r=e.drawable,n=r.current,s={};r.shapes.concat(r.autoShapes).concat(n?[n]:[]).forEach(function(e){e.dest&&(s[e.dest]=(s[e.dest]||0)+1)});var c=r.shapes.concat(r.autoShapes).map(function(e){return{shape:e,current:!1,hash:a(e,s,!1)}});n&&c.push({shape:n,current:!0,hash:a(n,s,!0)});var u=c.map(function(e){return e.hash}).join("");if(u!==M){M=u;var l=t.firstChild;o(r,c,l),i(e,c,r.brushes,s,t,l)}}},{"./util":17}],16:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.files=["a","b","c","d","e","f","g","h"],r.ranks=[1,2,3,4,5,6,7,8]},{}],17:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=e("./types");r.colors=["white","black"],r.invRanks=[8,7,6,5,4,3,2,1],r.allKeys=(i=Array.prototype).concat.apply(i,n.files.map(function(e){return n.ranks.map(function(t){return e+t})})),r.pos2key=function(e){return r.allKeys[8*e[0]+e[1]-9]},r.key2pos=function(e){return[e.charCodeAt(0)-96,e.charCodeAt(1)-48]},r.memo=function(e){var t,r=function(){return void 0===t&&(t=e()),t};return r.clear=function(){t=void 0},r},r.timer=function(){var e;return{start:function(){e=Date.now()},cancel:function(){e=void 0},stop:function(){if(!e)return 0;var t=Date.now()-e;return e=void 0,t}}},r.opposite=function(e){return"white"===e?"black":"white"},r.containsX=function(e,t){return!!e&&-1!==e.indexOf(t)},r.distanceSq=function(e,t){return Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2)},r.samePiece=function(e,t){return e.role===t.role&&e.color===t.color},r.computeIsTrident=function(){return window.navigator.userAgent.indexOf("Trident/")>-1};var o=function(e,t,r,n){return[(t?e[0]-1:8-e[0])*r,(t?8-e[1]:e[1]-1)*n]};r.posToTranslateAbs=function(e){var t=e.width/8,r=e.height/8;return function(e,n){return o(e,n,t,r)}},r.posToTranslateRel=function(e,t){return o(e,t,12.5,12.5)},r.translateAbs=function(e,t){e.style.transform="translate("+t[0]+"px,"+t[1]+"px)"},r.translateRel=function(e,t){e.style.left=t[0]+"%",e.style.top=t[1]+"%"},r.translateAway=function(e){return r.translateAbs(e,[-99999,-99999])},r.eventPosition=function(e){return e.clientX||0===e.clientX?[e.clientX,e.clientY]:e.touches&&e.targetTouches[0]?[e.targetTouches[0].clientX,e.targetTouches[0].clientY]:void 0},r.isRightButton=function(e){return 2===e.buttons||2===e.button},r.createEl=function(e,t){var r=document.createElement(e);return t&&(r.className=t),r},r.raf=(window.requestAnimationFrame||window.setTimeout).bind(window);var i},{"./types":16}],18:[function(e,t,r){"use strict";function n(e,t){var r,n=o.createEl("coords",t);for(var i in e)(r=o.createEl("coord")).textContent=e[i],n.appendChild(r);return n}Object.defineProperty(r,"__esModule",{value:!0});var o=e("./util"),i=e("./types"),a=e("./svg");r.default=function(e,t,r){e.innerHTML="",e.classList.add("cg-board-wrap"),o.colors.forEach(function(r){e.classList.toggle("orientation-"+r,t.orientation===r)}),e.classList.toggle("manipulable",!t.viewOnly);var s=o.createEl("div","cg-board");e.appendChild(s);var c;if(t.drawable.visible&&r&&((c=a.createElement("svg")).appendChild(a.createElement("defs")),e.appendChild(c)),t.coordinates){var u="black"===t.orientation?" black":"";e.appendChild(n(i.ranks,"ranks"+u)),e.appendChild(n(i.files,"files"+u))}var l;r&&(t.movable.showDests||t.premovable.showDests)&&(l=o.createEl("div","over"),o.translateAway(l),l.style.width=r.width/8+"px",l.style.height=r.height/8+"px",e.appendChild(l));var d;return r&&t.draggable.showGhost&&(d=o.createEl("piece","ghost"),o.translateAway(d),e.appendChild(d)),{board:s,over:l,ghost:d,svg:c}}},{"./svg":15,"./types":16,"./util":17}]},{},[11])(11)});